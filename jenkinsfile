pipeline {
    agent any

    stages{

        stage("Get repo") {
           steps {
                git url: "https://github.com/Kristijan-web/Exmoor.git",
                branch: "main"
           } 
        }
        stage("Install dependencys") {
            steps {
                dir('client') {
                    bat 'npm install'
                }
            }
         
        }
        stage("Run tests") {
            steps {
                dir('client') {
                    bat "npm test"
                }
                
            }
       
        }
        stage("Build") {
            steps {
                dir('client') {
                    bat "npm run build"
                }
            }
        }
        stage('Deploy to Netlify') {
          steps {
          withCredentials([
            string(credentialsId: 'NETLIFY_AUTH_TOKEN', variable: 'NETLIFY_AUTH_TOKEN'),
            string(credentialsId: 'NETLIFY_SITE_ID', variable: 'NETLIFY_SITE_ID')
          ]) {
            dir('client') {
             bat 'npx netlify-cli deploy --prod --dir=dist --site=%NETLIFY_SITE_ID%'
           }
         }
  }
}

    }
}